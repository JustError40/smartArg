{% extends "base.html" %}

{% block title %}База знаний — SmartArg{% endblock %}

{% block content %}
  <div class="mb-4">
    <h1 class="page-title mb-2">База знаний</h1>
    <p class="text-muted mb-0">Структурированные записи с дедлайнами, ссылками и объявлениями.</p>
  </div>

  <div class="glass-card p-4 mb-4">
    <form method="get" class="row g-3 align-items-end">
      <div class="col-12 col-md-4">
        <label class="form-label">Тип записи</label>
        <select name="entry_type" class="form-select">
          <option value="">Все типы</option>
          {% for value, label in entry_types %}
            <option value="{{ value }}" {% if value == selected_entry_type %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-12 col-md-6">
        <label class="form-label">Чат</label>
        <select name="chat" class="form-select">
          <option value="">Все чаты</option>
          {% for chat in chats %}
            <option value="{{ chat.id }}" {% if chat.id|stringformat:"s" == selected_chat %}selected{% endif %}>
              {{ chat.title|default:"Без названия" }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-12 col-md-2 d-grid">
        <button type="submit" class="btn btn-dark">Фильтр</button>
      </div>
    </form>
  </div>

  <div class="glass-card p-4">
    {% if entries %}
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead>
            <tr>
              <th scope="col">Тип</th>
              <th scope="col">Содержание</th>
              <th scope="col">Чат</th>
              <th scope="col">Дата</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in entries %}
              <tr>
                <td class="text-capitalize">{{ entry.get_entry_type_display }}</td>
                <td>{{ entry.content }}</td>
                <td>{{ entry.source_message.chat.title|default:"Без названия" }}</td>
                <td>{{ entry.created_at|date:"d.m.Y H:i" }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted mb-0">Записей пока нет.</p>
    {% endif %}
  </div>
{% endblock %}
